---
import Layout from "../../../layouts/Layout.astro";
import { PluginsFilters } from "./PluginsFilters";
import type { Plugin } from "./type";
import { pluginElementId } from "./utils";

const pluginsDataRequest = await fetch(
  "https://raw.githubusercontent.com/gephi/gephi-plugins/refs/heads/gh-pages/plugins/plugins.json",
);

const pluginsData: { plugins: Plugin[] } | null = pluginsDataRequest.ok ? await pluginsDataRequest.json() : null;
---

<Layout>
  <header><h1>Gephi plugins</h1></header>
  <main>
    {
      pluginsData === null ? (
        <h2>Sorry plugins data could not be loaded</h2>
      ) : (
        <div class="d-flex flex-columns">
          <PluginsFilters plugins={pluginsData.plugins} client:only />
          <div>
            {pluginsData.plugins.map((p) => (
              <div
                id={pluginElementId(p.id)}
                class={`category-${p.category} ${p.versions ? Object.keys(p.versions).map((v) => `version-${v}`) : ""}`}
              >
                {p.name}
              </div>
            ))}
          </div>
        </div>
      )
    }
  </main>
</Layout>
